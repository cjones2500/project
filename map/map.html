

<!DOCTYPE html>
<html>
<head>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
  	<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no' />
  	<script src='http://api.tiles.mapbox.com/mapbox.js/v1.0.4/mapbox.js'></script>
  	<link href='http://api.tiles.mapbox.com/mapbox.js/v1.0.4/mapbox.css' rel='stylesheet' />
  	<!--[if lte IE 8]>
    	<link href='http://api.tiles.mapbox.com/mapbox.js/v1.0.4/mapbox.ie.css' rel='stylesheet' >
  	<![endif]-->
  	<style>
    	body { margin:0; padding:0; }
    	#map { position:absolute; top:0; bottom:0; width:100%; }
  	</style>
</head>

<body>
	<style>
	.popup {
    	text-align: center;
	}
	.popup .slideshow {
    	width: 100%;
	}
	.popup .slideshow .image {
    	display: none;
	}
	.popup .slideshow .active {
    	display: block;
	}
	.popup .slideshow img {
    	width: 100%;
	}
	.popup .slideshow .caption {
    	background: #eee;
   		padding: 8px;
	}
	.popup .cycle {
    	height: 30px;
   	 	margin-top: 5px;
    	padding-top: 5px;
	}
	.popup .cycle a.prev {
    	float: left;
	}
	.popup .cycle a.next {
    	float: right;
	}
	</style>

<div id='map'></div>

<script type='text/javascript'>
var map = L.mapbox.map('map', 'examples.map-4l7djmvo')
	.setView([51.75202, -1.25773], 14)
	.addControl(L.mapbox.geocoderControl('examples.map-4l7djmvo'));;

var geoJson = [{
	type: 'Feature',
	"geometry": { "type": "Point", "coordinates": [-1.25773, 51.75202]},
	"properties": {
		'title': 'Oxford University',	
		'description': 'Pictures of Oxford University',	
        // Store the image url and caption in an array
        'images': [
          ['http://www.oxford-royale.co.uk/images/oxford-university.jpg','Oxford University Picture 1'],
          ['http://1.bp.blogspot.com/-pSdxeaMZMno/TnHdcI4lnRI/AAAAAAAAAFA/Ia_RCGSA6-g/s1600/Oxford+University+London+%25284%2529.jpg','Oxford University Picture 2'],
          ['http://lizarenyard.files.wordpress.com/2012/11/oxford-photo.jpg','Oxford Camera']
        ]
    }
}, 
{
	type: 'Feature',
    "geometry": { "type": "Point", "coordinates": [-74.00, 40.71]},
    "properties": {
        'title': 'New York City',
		'description': 'Pictures of New York City',
        'images': [
          ['http://i.imgur.com/exemdwr.png','Peter Minuit is credited with the purchase of the island of Manhattan in 1626.'],
          ['http://i.imgur.com/LHNDBpf.jpg','During the mid-19th Century, Broadway was extended the length of Manhattan.'],
          ['http://i.imgur.com/Pk3DYH1.jpg','Times Square has the highest annual attendance rate of any tourist attraction in the world.']
        ]

    	}
}];

// Add custom popup html to each marker
map.markerLayer.on('layeradd', function(e) {
    var marker = e.layer;
    var feature = marker.feature;
    var images = feature.properties.images
    var slideshowContent = '';

    for(var i = 0; i < images.length; i++) {
        var img = images[i];

        slideshowContent += '<div class="image' + (i === 0 ? ' active' : '') + '">' +
                              '<img src="' + img[0] + '" />' +
                              '<div class="caption">' + img[1] + '</div>' +
                            '</div>';
    }

    // Create custom popup content
    var popupContent =  '<div id="' + feature.properties.id + '" class="popup">' +
                            '<h2>' + feature.properties.title + '</h2>' +
                            '<div class="slideshow">' +
                                slideshowContent +
                            '</div>' +
							'<h5>' + feature.properties.description + 
                            '<div class="cycle">' +
                                '<a href="#" class="prev" onclick="return moveSlide(\'prev\')">&laquo; Previous</a>' +
                                '<a href="#" class="next" onclick="return moveSlide(\'next\')">Next &raquo;</a>' +
                            '</div>'
                        '</div>';

    // http://leafletjs.com/reference.html#popup
    marker.bindPopup(popupContent,{
        closeButton: false,
        minWidth: 320
    });
});

// Add features to the map
map.markerLayer.setGeoJSON(geoJson);

// This example uses jQuery to make selecting items in the slideshow easier.
// Download it from http://jquery.com
function moveSlide(direction) {
    var $slideshow = $('.slideshow'),
        totalSlides = $slideshow.children().length;

    if (direction === 'prev') {
        var $newSlide = $slideshow.find('.active').prev();
        if ($newSlide.index() < 0) {
            $newSlide = $('.image').last();
        }
    } else {
        var $newSlide = $slideshow.find('.active').next();
        if ($newSlide.index() < 0) {
            $newSlide = $('.image').first();
        }
    }

    $slideshow.find('.active').removeClass('active').hide();
    $newSlide.addClass('active').show();
    return false;
}

</script>

</body>
</html>


